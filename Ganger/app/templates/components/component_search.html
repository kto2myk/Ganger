<style>
    #search-container {
        position: fixed;
        top: 10px;
        right: 10px;
        width: 300px;
    }

    #search-box {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    #search-results {
        display: none; /* 初期は非表示 */
        border: 1px solid #ccc;
        background: white;
        position: absolute;
        top: 40px;
        width: 100%;
        z-index: 1000;
    }

    #search-users,
    #search-tags,
    #search-categories {
        padding: 10px;
        border-bottom: 1px solid #eee;
    }

    #search-users div,
    #search-tags div,
    #search-categories div {
        padding: 5px 0;
        cursor: pointer;
    }

    #search-users div:hover,
    #search-tags div:hover,
    #search-categories div:hover {
        background: #f0f0f0;
    }

</style>
<div id="search-container">
    <input
        type="text"
        id="search-box"
        placeholder="検索..."
        autocomplete="off"
    />
    <div id="search-results">
        <div id="search-users"></div>
        <div id="search-tags"></div>
        <div id="search-categories"></div>
    </div>
</div>
<script>
    const searchBox = document.getElementById("search-box");
    const searchResults = document.getElementById("search-results");
    let timeout = null;

    searchBox.addEventListener("input", () => {
    clearTimeout(timeout); // 前回のタイマーをクリア
        const query = searchBox.value.trim();

        if (query.length > 0) {
            timeout = setTimeout(() => {
            fetchResults(query); // 0.5秒後に検索
            }, 500);
        } else {
            searchResults.style.display = "none"; // クエリが空の場合は非表示
        }
        });

        async function fetchResults(query) {
        try {
            const response = await fetch(`/search_func`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query }),
            });
            const data = await response.json();
            displayResults(data);
        } catch (error) {
            console.error("Error fetching search results:", error);
        }
        }

        function displayResults(data) {
        // ユーザー、タグ、カテゴリごとの結果を表示
        const users = document.getElementById("search-users");
        const tags = document.getElementById("search-tags");
        const categories = document.getElementById("search-categories");

        users.innerHTML = data.users
            .map((user) => `<div>${user.username} (${user.user_id})</div>`)
            .join("");

        tags.innerHTML = data.tags
            .map((tag) => `<div>#${tag.tag_name}</div>`)
            .join("");

        categories.innerHTML = data.categories
            .map((category) => `<div>${category.category_name}</div>`)
            .join("");

        searchResults.style.display = "block";
    }
</script>
